# プラン変更チェック 処理フロー（完全版）

以下はGitHub Flavored Markdown (GFM) によるMermaidフローチャートです。

```mermaid
flowchart TD
    Start([処理モードチェック
    ])
    Start --> B2[初期処理]
    B2 --> B3[RP要求履歴登録（リクエスト）]
    B3 --> C[メンテナンスチェック]
    
    C -- NG --> O1[応答電文作成]
    C -- OK --> D[APIパラメータチェック]
    D -- NG --> O1[応答電文作成]
    D -- OK --> E[整合性チェック]
    E -- NG --> O1[応答電文作成]
    E -- OK --> F[契約共通処理<br>契約請求情報取得]
    F --> G[適用中クーポン情報取得]
    G --> H[適用中クーポン情報取得（重複）]
    H --> I[操作可否チェック]
    I --> J[契約共通処理・プラン変更請求情報取得]

    J --> K[無料延長クーポン情報取得]
    K --> L[適用予定クーポン情報取得]
    L --> M[契約詳細参照API・現契約情報取得]
    M --> N[返却オブジェクト設定]
    N --> O[応答電文作成]
    O --> P[RP要求履歴登録（レスポンス）]
    P --> Q[終了処理]   
    Q --> R[結果応答]
    R --> S{操作可否結果}
    S -- NG --> T1[終了処理]
    T1 --> T2
    S -- OK --> T2[返却オブジェクト設定]
    T2 --> U[応答電文作成]
    U --> End([結果応答])
```